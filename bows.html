<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ø®Ø²ÙˆÙ† Ø§Ù„ÙØ±Ø§Ø´Ø§Øª</title>
    <style>
        /* Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø¶Ù…Ù†Ø© (CSS) */
        body{font-family:Arial;direction:rtl;background:#f4f4f4;margin:0;padding:0;}
        .container{max-width:900px;margin:auto;background:#fff;padding:20px;border-radius:8px}
        h2{text-align:center;margin-bottom:15px;}
        table{width:100%;border-collapse:collapse;margin-top:15px}
        th,td{border:1px solid #ccc;padding:8px;text-align:center;font-size:14px;}
        .available{background:#e8ffe8}
        .unavailable{background:#ffd6d6} 
        button{padding:7px 12px;margin:5px;background:#3498db;color:#fff;border:none;cursor:pointer;border-radius:4px;}
        button:hover{opacity:0.85;}
        .add-item-form{background:#f9f9f9; padding:15px; border-radius:4px; margin-bottom:20px;}
        .add-item-form input{padding:8px; border:1px solid #ccc; border-radius:3px;}
    </style>
</head>
<body>

<div class="container">
    <h2>Ù…Ø®Ø²ÙˆÙ† Ø§Ù„ÙØ±Ø§Ø´Ø§Øª (Ø¥Ø¶Ø§ÙØ© ÙŠØ¯ÙˆÙŠØ©)</h2>

    <div class="add-item-form">
        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end;">
            <input id="itemName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© (Ù…Ø«Ø§Ù„: ÙØ±Ø§Ø´Ø© Ù…Ø®Ù…Ù„)" style="flex:2;">
            <input id="itemQuantity" type="number" min="1" value="1" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© / Ø§Ù„Ø¹Ø¯Ø¯" style="flex:1; max-width:150px;">
            <input id="itemColor" placeholder="Ø§Ù„Ù„ÙˆÙ† (Ù…Ø«Ù„ Ø¹Ù†Ø§Ø¨ÙŠ)" style="flex:1; max-width:150px;">
            <button onclick="addItem()" style="flex:1; max-width:150px; background:#27ae60;">+ Ø¥Ø¶Ø§ÙØ© Ù‚Ø·Ø¹</button>
        </div>
    </div>
    <table>
        <thead>
            <tr>
                <th>Ø§Ù„Ø§Ø³Ù…</th>
                <th>Ø§Ù„Ù„ÙˆÙ†</th> 
                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                <th>Ø­Ø°Ù</th>
            </tr>
        </thead>
        <tbody id="stockBody"></tbody>
    </table>
    <button onclick="window.location.href='inventory_management.html'">Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
</div>

<script>
const STOCK_TYPE = "bows"; // ğŸ›‘ Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ†: bows (Ù„Ù„ÙØ±Ø§Ø´Ø§Øª)

function getStock() {
    let stock = JSON.parse(localStorage.getItem(STOCK_TYPE)) || [];
    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø­Ù‚Ù„ Ø§Ù„ÙØªØ±Ø§Øª Ù„ÙƒÙ„ Ù‚Ø·Ø¹Ø© (Ù„Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø²Ù…Ù†ÙŠ)
    return stock.map((item, index) => ({
        ...item,
        rentedPeriods: item.rentedPeriods || [], 
        id: item.id !== undefined ? item.id : index 
    }));
}

function saveStock(stock) {
    localStorage.setItem(STOCK_TYPE, JSON.stringify(stock));
}

/**
 * ØªØ­Ø¯Ø¯ Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø·Ø¹Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø§Ù„ÙŠÙˆÙ…) Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙØªØ±Ø§Øª Ø§Ù„Ù…Ø¤Ø¬Ø±Ø©.
 */
function checkCurrentStatus(item) {
    const todayStr = new Date().toISOString().split('T')[0];
    const periods = item.rentedPeriods || [];

    for (const period of periods) {
        if (period.isReturned) continue; 
        
        const periodStart = period.start;
        const periodEnd = period.end;

        if (todayStr >= periodStart && todayStr < periodEnd) {
            return "Ù…Ø¤Ø¬Ø± Ø­Ø§Ù„ÙŠØ§Ù‹";
        }
    }
    return "Ù…ØªÙˆÙØ±";
}

// =======================================================
// ===== Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ…ÙŠØ©) =====
// =======================================================

function addItem() {
    const name = document.getElementById("itemName").value.trim();
    // ğŸ›‘ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† Ø­Ù‚Ù„ itemQuantity Ø§Ù„Ø¬Ø¯ÙŠØ¯
    const quantity = parseInt(document.getElementById("itemQuantity").value) || 0;
    const color = document.getElementById("itemColor").value.trim();
    
    if (!name || !color) {
        alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© ÙˆØ§Ù„Ù„ÙˆÙ†.");
        return;
    }
    
    if (quantity < 1) {
         alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø© (Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±).");
        return;
    }
    
    let stock = getStock();
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§Øª ÙŠØ³Ø§ÙˆÙŠ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¯Ø®Ù„Ø©
    for (let i = 0; i < quantity; i++) {
        const newItem = {
            name: name,
            // Ø§Ù„Ù…Ù‚Ø§Ø³ Ø³ÙŠØ¸Ù„ ÙƒÙ‚ÙŠÙ…Ø© Ø®Ø§Ù„ÙŠØ© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            size: "-", 
            color: color,
            rentedPeriods: [], 
            id: Date.now() + Math.random() + i // Ù„Ø¶Ù…Ø§Ù† Ù‡ÙˆÙŠØ© ÙØ±ÙŠØ¯Ø©
        };
        stock.push(newItem);
    }

    saveStock(stock); 
    renderStock(); 
    
    // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
    document.getElementById("itemName").value = "";
    document.getElementById("itemQuantity").value = "1"; // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙƒÙ…ÙŠØ© Ø¥Ù„Ù‰ 1
    document.getElementById("itemColor").value = "";

    // ğŸ›‘ ØªÙ… Ø­Ø°Ù Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù†Ø¬Ø§Ø­ (alert)
}

function deleteItem(index) {
    let stock = getStock();
    
    const currentStatus = checkCurrentStatus(stock[index]); 

    if (currentStatus === "Ù…Ø¤Ø¬Ø± Ø­Ø§Ù„ÙŠØ§Ù‹") {
        console.error("ERROR: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø·Ø¹Ø©. ÙŠØ¬Ø¨ Ø¥Ø±Ø¬Ø§Ø¹Ù‡Ø§ Ø£ÙˆÙ„Ø§Ù‹.");
        return;
    }
    
    stock.splice(index, 1);
    
    saveStock(stock);
    renderStock();
}


function renderStock(){
    let stock = getStock(); 
    let tbody = document.getElementById("stockBody");
    tbody.innerHTML = "";

    // ğŸ›‘ ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©: 4
    const COLSPAN = 4; 

    if (stock.length === 0) {
        tbody.innerHTML = `<tr><td colspan="${COLSPAN}">Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙØ§Ø±Øº. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø¥Ø¶Ø§ÙØ© Ù‚Ø·Ø¹ Ø¬Ø¯ÙŠØ¯Ø©.</td></tr>`;
        return;
    }

    stock.forEach((item, index) => {
        const currentStatus = checkCurrentStatus(item); 
        
        let statusClass = currentStatus === "Ù…ØªÙˆÙØ±" ? "available" : "unavailable";
        
        let deleteButton = currentStatus === "Ù…Ø¤Ø¬Ø± Ø­Ø§Ù„ÙŠØ§Ù‹" 
            ? `<button disabled style="background:#ccc; cursor:not-allowed;">Ù…Ø¤Ø¬Ø±Ø©</button>`
            : `<button onclick="deleteItem(${index})" style="background:#c0392b;">Ø­Ø°Ù</button>`;
        
        tbody.innerHTML += `
            <tr class="${statusClass}">
                <td>${item.name}</td>
                <td>${item.color || "-"}</td> 
                <td>${currentStatus}</td> 
                <td>${deleteButton}</td>
            </tr>
        `;
    });
}

renderStock();
</script>

</body>
</html>
