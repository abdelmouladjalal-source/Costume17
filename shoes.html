<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø£Ø­Ø°ÙŠØ©</title>
    <style>
        /* Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø¶Ù…Ù†Ø© (CSS) */
        body{font-family:Arial;direction:rtl;background:#f4f4f4;margin:0;padding:0;}
        .container{max-width:900px;margin:auto;background:#fff;padding:20px;border-radius:8px}
        h2{text-align:center;margin-bottom:15px;}
        table{width:100%;border-collapse:collapse;margin-top:15px}
        th,td{border:1px solid #ccc;padding:8px;text-align:center;font-size:14px;}
        .available{background:#e8ffe8}
        .unavailable{background:#ffd6d6} 
        button{padding:7px 12px;margin:5px;background:#3498db;color:#fff;border:none;cursor:pointer;border-radius:4px;}
        button:hover{opacity:0.85;}
        .add-item-form{background:#f9f9f9; padding:15px; border-radius:4px; margin-bottom:20px;}
        .add-item-form input{padding:8px; border:1px solid #ccc; border-radius:3px;}
    </style>
</head>
<body>

<div class="container">
    <h2>Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø£Ø­Ø°ÙŠØ© (Ø¥Ø¶Ø§ÙØ© ÙŠØ¯ÙˆÙŠØ©)</h2>

    <div class="add-item-form">
        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end;">
            <input id="itemName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© (Ù…Ø«Ø§Ù„: Ø­Ø°Ø§Ø¡ Ø¬Ù„Ø¯ Ø£Ø³ÙˆØ¯)" style="flex:2;">
            <input id="itemSize" placeholder="Ø§Ù„Ù…Ù‚Ø§Ø³ (Ù…Ø«Ø§Ù„: 42 Ø£Ùˆ 39-44)" style="flex:1; max-width:150px;">
            <input id="itemColor" placeholder="Ø§Ù„Ù„ÙˆÙ† (Ù…Ø«Ù„ Ø£Ø³ÙˆØ¯)" style="flex:1; max-width:150px;">
            <button onclick="addItem()" style="flex:1; max-width:150px; background:#27ae60;">+ Ø¥Ø¶Ø§ÙØ© Ù‚Ø·Ø¹Ø©</button>
        </div>
    </div>
    <table>
        <thead>
            <tr>
                <th>Ø§Ù„Ø§Ø³Ù…</th>
                <th>Ø§Ù„Ù…Ù‚Ø§Ø³</th>
                <th>Ø§Ù„Ù„ÙˆÙ†</th> 
                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                <th>Ø­Ø°Ù</th>
            </tr>
        </thead>
        <tbody id="stockBody"></tbody>
    </table>
    <button onclick="window.location.href='inventory_management.html'">Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
</div>

<script>
const STOCK_TYPE = "shoes";

function getStock() {
    let stock = JSON.parse(localStorage.getItem(STOCK_TYPE)) || [];
    return stock.map((item, index) => ({
        ...item,
        rentedPeriods: item.rentedPeriods || [], 
        id: item.id !== undefined ? item.id : index 
    }));
}

function saveStock(stock) {
    localStorage.setItem(STOCK_TYPE, JSON.stringify(stock));
}

/**
 * ØªØ­Ø¯Ø¯ Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø·Ø¹Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø§Ù„ÙŠÙˆÙ…) Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙØªØ±Ø§Øª Ø§Ù„Ù…Ø¤Ø¬Ø±Ø©.
 */
function checkCurrentStatus(item) {
    const todayStr = new Date().toISOString().split('T')[0];
    const periods = item.rentedPeriods || [];

    for (const period of periods) {
        if (period.isReturned) continue; 
        
        const periodStart = period.start;
        const periodEnd = period.end;

        if (todayStr >= periodStart && todayStr < periodEnd) {
            return "Ù…Ø¤Ø¬Ø± Ø­Ø§Ù„ÙŠØ§Ù‹";
        }
    }
    return "Ù…ØªÙˆÙØ±";
}

// =======================================================
// ===== Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (Ø¨Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠØ© ÙˆØ¨Ø¯ÙˆÙ† Ø¥Ø´Ø¹Ø§Ø± Ù†Ø¬Ø§Ø­) =====
// =======================================================

function addItem() {
    const name = document.getElementById("itemName").value.trim();
    const sizeInput = document.getElementById("itemSize").value.trim();
    const color = document.getElementById("itemColor").value.trim();
    
    if (!name || !sizeInput || !color) {
        alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…Ù‚Ø§Ø³ ÙˆØ§Ù„Ù„ÙˆÙ†.");
        return;
    }
    
    let stock = getStock();
    let sizesToAdd = [];

    // 1. ØªØ­Ù„ÙŠÙ„ Ø­Ù‚Ù„ Ø§Ù„Ù…Ù‚Ø§Ø³ Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ø·Ø§Ù‚ (Ù…Ø«Ù„Ø§Ù‹ 39-44)
    const rangeMatch = sizeInput.match(/^(\d+)[-â€“](\d+)$/);

    if (rangeMatch) {
        let startSize = parseInt(rangeMatch[1]);
        const endSize = parseInt(rangeMatch[2]);

        if (startSize > endSize) {
            alert("Ø§Ù„Ù…Ù‚Ø§Ø³ Ø§Ù„Ø£ÙˆÙ„ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ØµØºØ± Ù…Ù† Ø§Ù„Ù…Ù‚Ø§Ø³ Ø§Ù„Ø«Ø§Ù†ÙŠ.");
            return;
        }

        // ØªÙˆÙ„ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª Ø¨Ø²ÙŠØ§Ø¯Ø© 1 (ØªØ³Ù„Ø³Ù„ÙŠ)
        for (let size = startSize; size <= endSize; size++) {
            sizesToAdd.push(String(size));
        }

    } else {
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ù‚Ø§Ø³Ø§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹ ÙÙ‚Ø·
        sizesToAdd.push(sizeInput);
    }
    
    // 2. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø·Ø¹ ÙˆØ¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
    const itemsAddedCount = sizesToAdd.length;

    if (itemsAddedCount === 0 && rangeMatch) {
        alert("Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ù‚Ø§Ø³Ø§Øª ÙÙŠ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø­Ø¯Ø¯.");
        return;
    }
    
    sizesToAdd.forEach(size => {
        const newItem = {
            name: name,
            size: size, 
            color: color,
            rentedPeriods: [], 
            id: Date.now() + Math.random() 
        };
        stock.push(newItem);
    });

    saveStock(stock); 
    renderStock(); 
    
    // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
    document.getElementById("itemName").value = "";
    document.getElementById("itemSize").value = "";
    document.getElementById("itemColor").value = "";

    // ğŸ›‘ ØªÙ… Ø­Ø°Ù Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù†Ø¬Ø§Ø­ (alert)
}

function deleteItem(index) {
    let stock = getStock();
    
    const currentStatus = checkCurrentStatus(stock[index]); 

    if (currentStatus === "Ù…Ø¤Ø¬Ø± Ø­Ø§Ù„ÙŠØ§Ù‹") {
        console.error("ERROR: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø·Ø¹Ø©. ÙŠØ¬Ø¨ Ø¥Ø±Ø¬Ø§Ø¹Ù‡Ø§ Ø£ÙˆÙ„Ø§Ù‹.");
        return;
    }
    
    stock.splice(index, 1);
    
    saveStock(stock);
    renderStock();
}


function renderStock(){
    let stock = getStock(); 
    let tbody = document.getElementById("stockBody");
    tbody.innerHTML = "";

    if (stock.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5">Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙØ§Ø±Øº. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø¥Ø¶Ø§ÙØ© Ù‚Ø·Ø¹ Ø¬Ø¯ÙŠØ¯Ø©.</td></tr>';
        return;
    }

    stock.forEach((item, index) => {
        const currentStatus = checkCurrentStatus(item); 
        
        let statusClass = currentStatus === "Ù…ØªÙˆÙØ±" ? "available" : "unavailable";
        
        let deleteButton = currentStatus === "Ù…Ø¤Ø¬Ø± Ø­Ø§Ù„ÙŠØ§Ù‹" 
            ? `<button disabled style="background:#ccc; cursor:not-allowed;">Ù…Ø¤Ø¬Ø±Ø©</button>`
            : `<button onclick="deleteItem(${index})" style="background:#c0392b;">Ø­Ø°Ù</button>`;
        
        tbody.innerHTML += `
            <tr class="${statusClass}">
                <td>${item.name}</td>
                <td>${item.size || "-"}</td>
                <td>${item.color || "-"}</td> 
                <td>${currentStatus}</td> 
                <td>${deleteButton}</td>
            </tr>
        `;
    });
}

renderStock();
</script>

</body>
</html>
